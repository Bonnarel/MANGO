\documentclass[11pt,a4paper]{ivoa}
\input tthdefs

% suggestions by Mireille tagged as %mir

%mir \title{Mango: A Component and Association Based Model for Source Data}
\title{Mango: A Component and Association Based Model for representing data for astronomical sources}

% see ivoatexDoc for what group names to use here
\ivoagroup{DM}


\author{François Bonnarel}
\author{Gilles Landais}
\author{Laurent Michel}
\author{Jesus Salgado}
\author{Mireille Louys}
\author{Marco Molinaro}

\editor{Laurent Michel}

% \previousversion[????URL????]{????Concise Document Label????}
\previousversion{This is the first public release}
%mir 
\today

\begin{document}
\begin{abstract}
The Mango model proposes a flexible way to expose data related to astronomical source objects in an interoperable way. (petite modif pour tester)
It takes into account the huge diversity of source data in terms of feature description, format and usage. 
The Mango model attaches an identifier on an astronomical source and associates to it all data related : observed physical quantities called parameters in this context, and other information like spectra, time series, preview image, etc ... for that source. 
Parameters usually appear in the columns of a source catalogue. Additionnal dataproducts are bound to the source to contribute to the science analysis and enhance data understanding.

Parameters are modeled by the IVOA MCT DM reusing both native and extended classes. Parameters' roles are given by UCDs and semantic tags.
Associated data can be simple URLs, VO service endpoints or VO data model instances. Their roles are also qualified by semantic tags.

\end{abstract}


\section*{Acknowledgments}

We would like to thank all those who took the time to present their own use cases (INAF, CDS, CFA, ESAC) on which the model has been built.

We would also like to thank all the people having tested Mango on their own data.


We would like to thank all those who took the time to present their own use cases (INAF, CDS, CFA, ESAC) on which the model has been built.
We would also like to thank all the people having tested Mango on their own data.

\section*{Model Name}
This model was initially named with a very explicit but hard to remember acronym, \texttt{CAB-MSD} standing for Component and Association Based Model for Source Data. We decided later to rename it \texttt{Mango} with reference to the inside out mango picture used to introduce the model in Groningen. As the tradition requires that such unexpected names are acronyms, let's assume that \texttt{Mango} stands for Model for ANnotating Generic Objects.


\section*{Conformance-related definitions}

The words ``MUST'', ``SHALL'', ``SHOULD'', ``MAY'', ``RECOMMENDED'', and
``OPTIONAL'' (in upper or lower case) used in this document are to be
interpreted as described in IETF standard RFC2119 \citep{std:RFC2119}.

The \emph{Virtual Observatory (VO)} is a
general term for a collection of federated resources that can be used
to conduct astronomical research, education, and outreach.
The \href{http://www.ivoa.net}{International
Virtual Observatory Alliance (IVOA)} is a global
collaboration of separately funded projects to develop standards and
infrastructure that enable VO applications.


\section{Introduction}

The source DM is a long term concern for the DM working group and more generally for the IVOA.
In the past years, there were some proposals to design a global model for sources \citep{wd:jesusdm} of for catalogs \citep{wd:catalog}.
Other proposals, more model-agnostic, were focused on the data annotation in VOTables \citep{note:stcvot} \citep{note:seb}. In this case the goal was no longer to design a source model but to provide a complete description of  individual quantities (positions, velocity…).
None of these proposals have come to completion

The source DM issue resurfaced at the spring 2018 Interop in Victoria during an hands-on session focused on the tools available to work with VO data models and especially with VO-DML. The goal of this session was to annotate data from different origins in order to make them interoperable with each other. The main concern expressed during this session was not related to the tools themselves but to the lack of models for sources. 
This is a big paradox in the VO world ; source data which represent the basic bricks of the astronomer work, have no model. This paradox can be explained by the fact that sources data are multifaceted. The way of which source data are organized depends on the survey they come from, one the way they have been generated  and on the expected use. In a more general way, it depends on the science we want to do with them. This diversity cannot be endorsed by a single model. Having a global source model would lead to a very complex solution not usable in practice.

This standard proposes to overcome this paradox presenting model based on independent components and associated data that can be embedded on demand in a container.

\emph{Not designed to describe what a source is nut to help clients to discover and to understand the quantities available for a particular source instance TBC}

\subsection{Role within the VO Architecture}

\begin{figure}
\centering

% As of ivoatex 1.2, the architecture diagram is generated by ivoatex in
% SVG; copy ivoatex/archdiag-full.xml to archdiag.xml and throw out
% all lines not relevant to your standard.
% Notes don't generally need this.  If you don't copy archdiag.xml,
% you must remove archdiag.svg from FIGURES in the Makefile.

\includegraphics[width=0.9\textwidth]{role_diagram.pdf}
\caption{Architecture diagram for this document}
\label{fig:archdiag}
\end{figure}

Fig.~\ref{fig:archdiag} shows the role this document plays within the
IVOA architecture \citep{note:VOARCH}.



\section{Use Cases and  Requirements}

\subsection{Use Cases}
The use case below have been collected in 2019 from representative of some missions, archive or tools. The contribution was totally open. This gave a good picture of the needs but it's safe to say that not everything will supported by this first version.

\subsubsection{Gaia}
\begin{itemize}
    \item identifier
    \item reference position
    \item proper motion
    \item parallax and distance
    \item correlation,
    \item source extension
    \item radial velocity
    \item redshift
    \item luminosity
    \item date
    \item multiple detection
\end{itemize}


\subsubsection{Euclid}
\begin{itemize}    
    \item identifier
    \item position
    \item correlation with Gaia
    \item photometry (ground + sat),
    \item morphology
    \item redshift
    \item photometric redshift
\end{itemize}

\subsubsection{Exoplanets}
\begin{itemize}
    \item position
    \item orbit
    \item different source level(star, planet, moon)
    \item status and classification
    \item orbiting system description
\end{itemize}

\subsubsection{Morphologically Complex Structures}
\begin{itemize}    
    \item morphology
\end{itemize}

\subsubsection{Chandra} 
All quantities are time dependant,
Dependant on calibration + physical
model
\begin{itemize}    
    \item name
    \item pos
    \item time
    \item extension
    \item PHA 
\end{itemize}

\subsubsection{Vizier} 
All possible measure are present in Vizier in addition to lots of associated data 
\begin{itemize}    
    \item pre-existing data
    \item grouping columns
    \item lots of available metadata
    \item column name formatting
    \item one column different frames
\end{itemize}

\subsubsection{Aladin}

Quantities possibly plotted or matched with some of other datasets
\begin{itemize}
    \item position
    \item time
    \item flux
    \item link
    \item FoV
    \item column grouping
\end{itemize}

\subsubsection{X\-match}
\begin{itemize}
    \item Identifier
    \item position
    \item proper motion
    \item photometry
\end{itemize}

\subsubsection{Time Domain}
\begin{itemize}
    \item Identifier: object identifier
    \item Position: moving object
    \item Associated products: time series of e.g. a spectrum or an image
    \item Photometry: for light curves
    \item Timestamp: Independent axis of the time series
\end{itemize}

There are 2 distinct categories of requested quantities , the measures and the associated data. The measures
 can be numerical values or simple strings. The Mango measures rely on the Meas model. The associated data are related to data with a complex structures or to references. table  \ref{tab:q_breakup} shows the breaking up of the quantities liste above in these 2 categories

\begin{table}[ht!]
     \tiny
     \begin{tabular}{|p{2.4cm}|p{0.4cm}|p{0.4cm}|p{0.4cm}|p{0.6cm}|p{0.4cm}|p{0.4cm}|p{0.4cm}|p{0.4cm}|p{0.4cm}|}
       \hline Quantity &  Ga &  Eu &  Ex &  MCS  &  Ch&  Vi &  Al &  Xm&  TD \\
       \hline  \texttt{identifier}      &  p & P  &P& &P&P &P&  & P \\              
       \hline  \texttt{position}      &  p & P  &P& &P&P &P&  & P \\       
       \hline  \texttt{pr. motion}   & p &   &   &    &  &   &P&P&    \\       
       \hline  \texttt{distance}     & p &   &   &    &  &   &P&  &    \\       
       \hline  \texttt{correlation}   & AD &AD&   &    &  &AD &   &  &    \\       
       \hline  \texttt{extension}     &P&   &P&P &P&P& P&  &    \\       
       \hline  \texttt{rad. vel.}       &  P &   &   &    &  &P&   &  &    \\       
       \hline  \texttt{redshift}        &  P &P&   &    &  &P&   &  &    \\             
       \hline  \texttt{phot. rsft}      &   &P&   &    &  &P&   &  &    \\       
       \hline  \texttt{luminosity}    & P&P&   &    &  &P&P&P&P\\       
       \hline  \texttt{date}             & P  &   &   &    & P&P&   &  &P\\       
       \hline  \texttt{detections}    &  AD &   &   &    &  &   &   &  &    \\       
       \hline  \texttt{orbit}             &   &   &P& &  &   &   &  &    \\       
       \hline  \texttt{type}             &   &   & P& &  &P&   &  &    \\      
       \hline  \texttt{status}          &   &   &   &    &  &P&   &  &    \\       
       \hline  \texttt{orb. sys.}      &   &   &  P &    &  &   &   &  &    \\       
       \hline  \texttt{PHA}            &   &   &   &    &P&   &   &  &    \\       
       \hline  \texttt{ass. prd.}     &   &   &   &    &  &AD&   &  &AD \\       
       \hline 
     \end{tabular}
     \caption{ Break up of the requested quantities \texttt{P} parameter, \texttt{AD} Associated data} 
     \label{tab:q_breakup}
 \end{table}


\subsection{Requirements}

\subsubsection{R01: Supported Quantities}
\begin{itemize}
    \item Mango must provide unique source identifiers.
    \item Mango must provide modeling classes for both parameters and associated data.
    \item The number of parameters attached to Mango instances must be free.
    \item The number of associated data attached to Mango instances must be free.
\end{itemize}

\subsubsection{R02: Parameters}
The notion of parameter matches the concept of measure in the Meas model. Mango may support parameter classes that are not  Meas classes though.
  
\begin{itemize}
    \item Mango must support explict classes for the most used parameters.
    \item Mang must provide a generic way to support parameters that have not specif classes.
    \item Mango instances must support multiple instances of the same parameter class.
    \item The presence of any parameter in Mango instances must be optional.
    \item Mango must provide a way to identify the role of each parameter.
    \item The role of each parameter should be machine-readable.
    \item Each parameter must be able to be attached to a timestamp or a flag. The meaning of these flag is not part of Mango, but Mango must provide a way to describe it.
\end{itemize}

\subsubsection{R03: Associated Data}
The notion of associated data relates to any sort of complex data. This can be a pointer to a service or a data set, a data table or  other data structure.
\begin{itemize}
    \item Mango must support references to external datasets.
    \item Mango must support references to external services.
    \item Mango must support references to other Mango instances.
    \item Mango  must support references to instances of models serialized in VO-DML. 
    \item Mango instances must support multiple instances of the same associated data class.
    \item The presence of any associated data in Mango instances must be optional.
    \item Mango must provide a way to identify the role of each associated data.
    \item The role of each associated data should be machine-readable.
 \end{itemize}

\section{Model Overview}

\begin{figure}
\includegraphics[width=0.9\textwidth]{../model/overview_diagram.png}
\caption{Mango overview}
\label{fig:overview}
\end{figure}

The root class of the model is the \texttt{Source} class that has only one attribute, the identifier, that is the only quantity common to  all  Mango instances.

Each quantity or associated data attached to a source is represented by a connector describing the nature of either the quantity or of the associated data.

There is no restriction on the set of connectors attached to one source.
There are 2 classes of connectors

\subsection{The parameters} 
Parameter connectors are used to bind measures with the source. One connector can only reference one measure. The measure itself is modeled by a class of the Measure model or by an extension of this model. Measure extensions are part of Mango. 
In addition to its class, the nature of a measure is given by a UCD and a semantic tag. The UCD gives the physical meaning of the measure whereas the semantic tag says more about the usage context of the measure. This can be for instance the reduction status (raw, corrected). The vocabulary allowed for the semantic is managed as a VO vocabulary. 


\begin{table}[ht!]
     \tiny
     \begin{tabular}{|p{2.4cm}|p{1.8cm}|p{7cm}|}
       \hline Quantity &  Model &  \\
       \hline  \texttt{identifier}      & Mango & required for anu instance\\                    
       \hline  \texttt{position}      &  Meas &  \\       
       \hline  \texttt{pr. motion}   & Meas &     \\       
       \hline  \texttt{distance}     & Ext Meas &     \\       
       \hline  \texttt{correlation}   & Ass data & reference to other Mango instances     \\       
       \hline  \texttt{extension}     & Ext Meas & Can be used for FoV, morphlogy or shape\\       
       \hline  \texttt{rad. vel.}       &  Ext Meas  &       \\       
       \hline  \texttt{redshift}        &   Ext Meas  &  \\             
       \hline  \texttt{phot. rsft}      & Ext Meas&    \\       
       \hline  \texttt{luminosity}    & Ext Meas&\\       
       \hline  \texttt{date}             & Meas & date or time stamp\\       
       \hline  \texttt{detections}    & Ass data & reference to other Mango instances   \\       
       \hline  \texttt{orbit}             & Ext Meas&      \\       
       \hline  \texttt{type}             &Ext Meas&     \\      
       \hline  \texttt{status}          &Ext Meas&     \\       
       \hline  \texttt{orb. sys.}      &Ext Meas&     \\       
       \hline  \texttt{PHA}            &Ext Meas&     \\       
       \hline  \texttt{ass. prd.}     &Ass data&  \\       
       \hline 
     \end{tabular}
     \caption{ \texttt{Meas} Measue class, \texttt{Ext Meas } Measure extension, \texttt{Ass data  } Mangno associated data} 
 \end{table}


\subsubsection{Parameter UCD}

\begin{table}[ht!]
     \begin{tabular}{|p{4cm}|p{3cm}|p{3.5cm}|}
       \hline Parameter &  Original model & UCDs 1+ first word  \\
       \hline  \texttt{Position}             &  Measure  &  pos \\       
       \hline  \texttt{Velocity  }            &  Measure & phys.veloc      \\              
       \hline  \texttt{Proper motion}    & Measure & pos.pm    \\       
       \hline  \texttt{Time}                   & Measure &  time.epoch   \\       
       \hline  \texttt{Polarization}         & Measure & phys.polarization \\      
       \hline  \texttt{SphericalSkyPosition}    &  Mango  &  pos.eq \\       
       \hline  \texttt{ObjectType}                   &  Mango  & src.class \\       
       \hline  \texttt{Redshift}                        &  Mango  & src.redshift \\       
       \hline  \texttt{Luminosity}                    &  Mango  & phot.qqqchose \\
       \hline  \texttt{HardnessRatio}             &  Mango  & phot.flux;arith.ratio \\
       \hline  \texttt{Shape}                     &  Mango  & phys.area \\
       \hline  \texttt{Flag}                        &  Mango  & meta.code  \\
       \hline  \texttt{Orbit}                       &  Mango  & src.orbital \\    
       \hline  \texttt{GenericMeasure}    &  Measure  &  Appropiate physical UCD \\    
       \hline 
     \end{tabular}
     \caption{ UCDs to be set for the supported parameters} 
     \label{tab:ucds}
 \end{table}

TBC phys.luminosity  vs phot.flux
ajoutdr une temperature

\subsection{Associated Data} 
Associated data connectors are used to bind any sort of complex data with the source. One connector can only refer to one dataset. Associated data can be either URIs (VO services or not) or reference to instances of other VO models (Obscore, Provenance…).

Attaching VO model instances to sources does not mean that these  models must be imported. The merge between a Mango instance and one associated instance is operated by the data annotation process. The indication given by Mango tell the client how to interpret the embedded instance

\subsection{STC Extension} 

All STC measures are built upon the same pattern (see fig \ref{fig:stcpattern}). The value(s) \texttt{Measure} object is carried by a \texttt{Coordinate} object. The coordinate is attached to a system (class \texttt{CoordSys}). The system has 2 components 1) the space  (class \texttt{CoordSpace}) that describes the axis and 2) the frame    \texttt{CoordFrame}).  All Mango parameters are based on this pattern. Native STC classes are used when possible. Others parameters are built by extending STC classes . Figure \ref{fig:stcpattern}) shows the extended STC classes being part of Mango 
\begin{figure}
     \includegraphics[width=0.9\textwidth]{stc_pattern.png}
     \caption{STC pattern (simplified view)}
     \label{fig:stcpattern}
\end{figure}

\begin{figure}
  \includegraphics[angle=90,origin=c,width=1\textwidth]{../model/stc_ext_diagram.png}
  \caption{STC extension diagram }
  \label{fig:stcextension}
\end{figure}


\input{model.tex}

\section{TAP and Mango}
This not normative section gives possible tips to save and discover Mango instances in TAP services.
We suppose that the TAP service hosts catalogs which sources are Mango instances. These catalogs are named \emph{Mango Catalogs}.

\subsection{Storing Mango Catalogs in TAP}
For now this section only concerns the parameter. The associated data will be taken into account later.

\begin{itemize}
  \item One master table for the catalogs with various meta-data out of the Mango scope plus a unique identifier (primary key)
  \item One master sources table for the source instances with the catalog identifier and a primary key safer than the Mango identifier.
  \item One table for each supported parameter with a foreign key for the join with the master source table
\end{itemize}

Although the model of the measures is hierarchical, it should be possible to flatten them in one single table considering that the model structure can be retrieved with the TAP\_SCHEMA annotations (TBC) 

This schema requires the server to explore all the parameter tables to retrieve  whole Mango instances. This process can be speed up by using the \emph{MangoCore} table.

\subsection{ \emph{MangoCore} Table}

The discovery of \emph{Mango Catalogs} can be helped by a  \emph{MangoCore} table located in the  \emph{schema} schema. As Mango is not dedicated to any specific domain, we cannot define a set of core parameters, but parameters can be flagged as \emph{Core Parameter}. This selection is left at the discretion of the curator.
The \emph{MangoCore} table has set of columns per parameter class plus one for the catalog ID. It has one row per stored catalog. Each parameter has at least 2 columns: one with the UCD an one with the \emph{Core} flag. TBC


\appendix
\section{Changes from Previous Versions}

No previous versions yet.  
% these would be subsections "Changes from v. WD-..."
% Use itemize environments.


% NOTE: IVOA recommendations must be cited from docrepo rather than ivoabib
% (REC entries there are for legacy documents only)
\bibliography{myrefs,ivoatex/ivoabib,ivoatex/docrepo}


\end{document}
